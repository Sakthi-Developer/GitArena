import{a as p,b as v,r as l,u as a,j as e}from"./index-K-32Q3oD.js";import{C as b,G as j,T as N,e as w,g as C,r as S}from"./Controls-C6VtgubP.js";import{g as y,v as L}from"./levels-D9FzCBIE.js";import"./isomorphic-git-C77K5K18.js";function H(){const{levelId:o}=p(),h=v(),[r,u]=l.useState(!0),[i,f]=l.useState(-1),t=o?y(o):void 0;l.useEffect(()=>t?((async()=>{a.getState().setLoading(!0),a.getState().setActiveLevelId(t.id);const s=S();await s.init();for(const x of t.setupCommands)await w(x,s);const c=await s.allCommits(),d=await s.currentBranch(),m=await s.listBranches();a.getState().setCommits(c),a.getState().setCurrentBranch(d),a.getState().setBranches(m),a.getState().clearHistory(),a.getState().setEngineReady(!0),a.getState().setLoading(!1)})(),()=>{a.getState().setActiveLevelId(null)}):void 0,[t]);const g=l.useCallback(async()=>{if(!t)return;const n=C(),s=await n.allCommits(),c=await n.currentBranch(),d=await n.listBranches();if((await L(t,s,c,d)).passed){const x=a.getState().commandCount;a.getState().markLevelComplete(t.id,x)}},[t]);return t?e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"border-b border-arena-border bg-arena-surface/50",children:[e.jsxs("button",{className:"w-full flex items-center justify-between px-3 py-1.5 text-left",onClick:()=>u(!r),"aria-expanded":r,"aria-controls":"goal-panel",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-semibold text-arena-text",children:t.title}),e.jsx("span",{className:"text-[11px] text-arena-textDim font-mono px-1 py-[1px] bg-arena-bg rounded",children:t.difficulty})]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",className:`text-arena-textDim transition-transform ${r?"rotate-180":""}`,"aria-hidden":"true",children:e.jsx("path",{d:"M12.78 5.22a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L3.22 6.28a.75.75 0 0 1 1.06-1.06L8 8.94l3.72-3.72a.75.75 0 0 1 1.06 0z"})})]}),r&&e.jsxs("div",{id:"goal-panel",className:"px-3 pb-2 animate-fade-in",children:[e.jsx("p",{className:"text-sm text-arena-textMuted leading-relaxed mb-1.5",children:t.goal}),t.hints.length>0&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>f(n=>Math.min(n+1,t.hints.length-1)),className:"text-xs text-arena-accent hover:text-arena-accentHover transition-colors",children:i<0?"Show hint":i<t.hints.length-1?"Next hint":"No more hints"}),i>=0&&e.jsxs("p",{className:"text-xs text-arena-warning font-mono mt-0.5 animate-fade-in",children:["Hint: ",t.hints[i]]})]})]})]}),e.jsx(b,{}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsx("div",{className:"flex-1 min-h-[200px]",children:e.jsx(j,{})}),e.jsx("div",{className:"h-[250px] md:h-auto md:w-[400px] border-t md:border-t-0 md:border-l border-arena-border relative",children:e.jsx(N,{onCommandExecuted:g})})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-arena-text mb-1",children:"Level not found"}),e.jsxs("p",{className:"text-arena-textMuted mb-2",children:['The level "',o,`" doesn't exist.`]}),e.jsx("button",{onClick:()=>h("/"),className:"btn-primary text-sm",children:"Back to Home"})]})})}export{H as default};
