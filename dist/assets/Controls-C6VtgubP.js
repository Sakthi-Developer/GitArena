var K=Object.defineProperty;var J=(s,e,t)=>e in s?K(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var M=(s,e,t)=>J(s,typeof e!="symbol"?e+"":e,t);import{u as y,c as G,r as d,d as Q,e as ee,f as te,g as $,j as p,h as z,t as T,i as se,k as ne,l as re,m as ae}from"./index-K-32Q3oD.js";import{g as ie,r as oe}from"./isomorphic-git-C77K5K18.js";import{g as ce}from"./levels-D9FzCBIE.js";function L(s,e,t){return Math.min(Math.max(s,e),t)}function le(s){let e=!1,t=null;return(...n)=>{t=n,e||(e=!0,requestAnimationFrame(()=>{e=!1,t&&s(...t)}))}}function ue(s){return s.slice(0,7)}const H=.1,O=3,he=.001;function fe(s){const e=y(G),t=y(i=>i.setView),n=d.useRef(!1),a=d.useRef({x:0,y:0}),r=d.useRef(le(i=>t(i))).current,o=d.useCallback(i=>{var l;i.preventDefault();const{zoom:w,panX:m,panY:C}=y.getState().view;if(i.ctrlKey||i.metaKey){const b=-i.deltaY*he,R=L(w*(1+b),H,O),N=(l=s.current)==null?void 0:l.getBoundingClientRect();if(N){const A=i.clientX-N.left,j=i.clientY-N.top,P=R/w,f=A-(A-m)*P,g=j-(j-C)*P;r({zoom:R,panX:f,panY:g})}else r({zoom:R})}else r({panX:m-i.deltaX,panY:C-i.deltaY})},[s,r]),u=d.useCallback(i=>{var w,m;(i.button===0||i.button===1)&&(n.current=!0,a.current={x:i.clientX,y:i.clientY},(m=(w=i.target)==null?void 0:w.setPointerCapture)==null||m.call(w,i.pointerId))},[]),c=d.useCallback(i=>{if(!n.current)return;const w=i.clientX-a.current.x,m=i.clientY-a.current.y;a.current={x:i.clientX,y:i.clientY};const{panX:C,panY:l}=y.getState().view;r({panX:C+w,panY:l+m})},[r]),h=d.useCallback(()=>{n.current=!1},[]);d.useEffect(()=>{const i=s.current;if(i)return i.addEventListener("wheel",o,{passive:!1}),i.addEventListener("pointerdown",u),i.addEventListener("pointermove",c),i.addEventListener("pointerup",h),i.addEventListener("pointerleave",h),()=>{i.removeEventListener("wheel",o),i.removeEventListener("pointerdown",u),i.removeEventListener("pointermove",c),i.removeEventListener("pointerup",h),i.removeEventListener("pointerleave",h)}},[s,o,u,c,h]);const x=d.useCallback(()=>{t({panX:0,panY:0,zoom:1})},[t]),E=d.useCallback(()=>{const{zoom:i}=y.getState().view;t({zoom:L(i*1.2,H,O)})},[t]),B=d.useCallback(()=>{const{zoom:i}=y.getState().view;t({zoom:L(i/1.2,H,O)})},[t]);return{view:e,resetView:x,zoomIn:E,zoomOut:B}}function de(s,e,t,n,a,r,o,u,c){s.clearRect(0,0,r,o),s.save(),s.translate(t,n),s.scale(a,a);const h=a<.3||e.nodes.length>$.lodThreshold,x=h?$.nodeRadiusLOD:$.nodeRadius,E=-t/a-$.virtualizationPadding,B=-n/a-$.virtualizationPadding,i=(r-t)/a+$.virtualizationPadding,w=(o-n)/a+$.virtualizationPadding;let m;c?m=c.queryRect({x:E,y:B,width:i-E,height:w-B}):m=e.nodes.filter(l=>l.x>=E&&l.x<=i&&l.y>=B&&l.y<=w);const C=new Set(m.map(l=>l.oid));s.lineWidth=$.lineWidth,s.lineCap="round",s.lineJoin="round";for(const l of e.edges){if(!C.has(l.from)&&!C.has(l.to))continue;s.strokeStyle=l.color,s.globalAlpha=.6,s.beginPath();const b=l.points;b.length===2?(s.moveTo(b[0].x,b[0].y),s.lineTo(b[1].x,b[1].y)):b.length===4&&(s.moveTo(b[0].x,b[0].y),s.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)),s.stroke()}s.globalAlpha=1;for(const l of m){const b=l.oid===u,R=l.isHead;if(s.beginPath(),s.arc(l.x,l.y,x,0,Math.PI*2),R?(s.fillStyle=l.color,s.fill(),s.shadowColor=l.color,s.shadowBlur=12,s.fill(),s.shadowBlur=0):(s.fillStyle=z.surface,s.fill(),s.strokeStyle=l.color,s.lineWidth=b?$.headHighlightWidth:$.lineWidth,s.stroke()),b&&(s.beginPath(),s.arc(l.x,l.y,x+4,0,Math.PI*2),s.strokeStyle=z.accent,s.lineWidth=2,s.setLineDash([4,4]),s.stroke(),s.setLineDash([])),!h){s.fillStyle=R?"#ffffff":z.text,s.font=`${T.weights.medium} ${$.fontSize-2}px ${T.fontMono}`,s.textAlign="center",s.textBaseline="middle",s.fillText(ue(l.oid),l.x,l.y),s.fillStyle=z.textMuted,s.font=`${T.weights.normal} ${$.fontSize-1}px ${T.fontSans}`,s.textAlign="center";const N=l.message.length>30?l.message.slice(0,27)+"...":l.message;if(s.fillText(N,l.x,l.y+x+16),l.refs.length>0){let A=l.x+x+12;const j=l.y;s.textAlign="left",s.textBaseline="middle";for(const P of l.refs){const f=P;s.font=`${T.weights.semibold} ${$.fontSize-1}px ${T.fontMono}`;const g=s.measureText(f),k=$.labelPadding,D=g.width+k*2,_=20;if(s.fillStyle=l.color+"25",s.strokeStyle=l.color+"60",s.lineWidth=1,me(s,A,j-_/2,D,_,6),s.fill(),s.stroke(),s.fillStyle=l.color,s.fillText(f,A+k,j+1),l.isHead){const Z=A+D+6;s.fillStyle=z.warning,s.font=`${T.weights.bold} ${$.fontSize-2}px ${T.fontMono}`,s.fillText("HEAD",Z,j+1)}A+=D+8}}}}s.restore()}function me(s,e,t,n,a,r){s.beginPath(),s.moveTo(e+r,t),s.lineTo(e+n-r,t),s.arcTo(e+n,t,e+n,t+r,r),s.lineTo(e+n,t+a-r),s.arcTo(e+n,t+a,e+n-r,t+a,r),s.lineTo(e+r,t+a),s.arcTo(e,t+a,e,t+a-r,r),s.lineTo(e,t+r),s.arcTo(e,t,e+r,t,r),s.closePath()}const Te=d.memo(function(){const e=d.useRef(null),t=d.useRef(null),n=d.useRef(null),a=d.useRef(0),r=y(Q),o=y(G),u=y(ee),c=y(i=>i.setSelectedNode),{resetView:h,zoomIn:x,zoomOut:E}=fe(e);d.useEffect(()=>{r.nodes.length>0?n.current=te(r):n.current=null},[r]),d.useEffect(()=>{const i=t.current,w=e.current;if(!i||!w)return;const m=new ResizeObserver(C=>{for(const l of C){const{width:b,height:R}=l.contentRect,N=window.devicePixelRatio||1;w.width=b*N,w.height=R*N,w.style.width=`${b}px`,w.style.height=`${R}px`}});return m.observe(i),()=>m.disconnect()},[]),d.useEffect(()=>{const i=e.current;if(!i)return;const w=i.getContext("2d");if(!w)return;const m=window.devicePixelRatio||1;w.setTransform(m,0,0,m,0,0);const C=i.width/m,l=i.height/m;return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{de(w,r,o.panX,o.panY,o.zoom,C,l,u,n.current)}),()=>cancelAnimationFrame(a.current)},[r,o,u]);const B=d.useCallback(i=>{const w=e.current;if(!w||!n.current)return;const m=w.getBoundingClientRect(),{panX:C,panY:l,zoom:b}=y.getState().view,R=(i.clientX-m.left-C)/b,N=(i.clientY-m.top-l)/b,A=n.current.queryNearest(R,N,$.nodeRadius*1.5);c((A==null?void 0:A.oid)??null)},[c]);return p.jsxs("div",{ref:t,className:"relative flex-1 overflow-hidden bg-arena-bg",children:[p.jsx("canvas",{ref:e,className:"absolute inset-0 w-full h-full cursor-grab active:cursor-grabbing",onClick:B,role:"img","aria-label":"Git commit graph visualization",tabIndex:0}),p.jsxs("div",{className:"absolute bottom-3 right-3 flex flex-col gap-0.5 z-10",role:"toolbar","aria-label":"Graph zoom controls",children:[p.jsx("button",{onClick:x,className:"btn-ghost w-[36px] h-[36px] flex items-center justify-center rounded-lg bg-arena-surface border border-arena-border text-lg","aria-label":"Zoom in",children:"+"}),p.jsx("button",{onClick:E,className:"btn-ghost w-[36px] h-[36px] flex items-center justify-center rounded-lg bg-arena-surface border border-arena-border text-lg","aria-label":"Zoom out",children:"-"}),p.jsx("button",{onClick:h,className:"btn-ghost w-[36px] h-[36px] flex items-center justify-center rounded-lg bg-arena-surface border border-arena-border text-xs","aria-label":"Reset view",children:"fit"})]}),r.nodes.length===0&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-arena-textDim text-sm",children:"No commits yet. Use the terminal to create commits."})]})});var pe=oe();const S=ie(pe);class F{constructor(){M(this,"root",{type:"dir",children:new Map})}resolve(e){return e.split("/").filter(Boolean)}getParent(e){var n;let t=this.root;for(let a=0;a<e.length-1;a++){const r=(n=t.children)==null?void 0:n.get(e[a]);if(!r||r.type!=="dir")return null;t=r}return t}mkdirp(e){let t=this.root;for(const n of e){t.children||(t.children=new Map);let a=t.children.get(n);a||(a={type:"dir",children:new Map},t.children.set(n,a)),t=a}return t}readFile(e){var a;const t=this.resolve(e);let n=this.root;for(const r of t){const o=(a=n.children)==null?void 0:a.get(r);if(!o)throw new Error(`ENOENT: ${e}`);n=o}if(n.type!=="file"||!n.content)throw new Error(`EISDIR: ${e}`);return n.content}writeFile(e,t){const n=this.resolve(e),a=this.mkdirp(n.slice(0,-1)),r=typeof t=="string"?new TextEncoder().encode(t):t;a.children||(a.children=new Map),a.children.set(n[n.length-1],{type:"file",content:r})}unlink(e){const t=this.resolve(e),n=this.getParent(t);n!=null&&n.children&&n.children.delete(t[t.length-1])}readdir(e){var a,r;const t=this.resolve(e);let n=this.root;for(const o of t){const u=(a=n.children)==null?void 0:a.get(o);if(!u||u.type!=="dir")throw new Error(`ENOENT: ${e}`);n=u}return Array.from(((r=n.children)==null?void 0:r.keys())??[])}mkdir(e){const t=this.resolve(e);this.mkdirp(t)}rmdir(e){const t=this.resolve(e),n=this.getParent(t);n!=null&&n.children&&n.children.delete(t[t.length-1])}stat(e){var a;const t=this.resolve(e);let n=this.root;if(t.length===0)return{type:"dir",isFile:()=>!1,isDirectory:()=>!0,isSymbolicLink:()=>!1};for(const r of t){const o=(a=n.children)==null?void 0:a.get(r);if(!o)throw new Error(`ENOENT: ${e}`);n=o}return{type:n.type,isFile:()=>n.type==="file",isDirectory:()=>n.type==="dir",isSymbolicLink:()=>!1}}lstat(e){return this.stat(e)}snapshot(){const e=new Map,t=(n,a)=>{if(n.type==="file"&&n.content&&e.set(a,n.content),n.children)for(const[r,o]of n.children)t(o,a?`${a}/${r}`:r)};return t(this.root,""),e}restore(e){this.root={type:"dir",children:new Map};for(const[t,n]of e)this.writeFile(t,n)}}function W(s){return{promises:{readFile:async e=>s.readFile(e),writeFile:async(e,t)=>s.writeFile(e,t),unlink:async e=>s.unlink(e),readdir:async e=>s.readdir(e),mkdir:async e=>s.mkdir(e),rmdir:async e=>s.rmdir(e),stat:async e=>s.stat(e),lstat:async e=>s.lstat(e)}}}const v="/repo";class U{constructor(){M(this,"memfs");M(this,"fs");M(this,"author",{name:"Player",email:"player@gitarena.dev"});M(this,"_initialized",!1);M(this,"_initPromise",null);this.memfs=new F,this.fs=W(this.memfs)}get initialized(){return this._initialized}async ensureInitialized(){if(!this._initialized){if(this._initPromise)return this._initPromise;this._initPromise=this.init(),await this._initPromise}}async init(){this.memfs=new F,this.fs=W(this.memfs),this._initialized=!1,await S.init({fs:this.fs,dir:v,defaultBranch:"main"}),this.memfs.writeFile(`${v}/README.md`,`# GitArena
`),await S.add({fs:this.fs,dir:v,filepath:"README.md"}),await S.commit({fs:this.fs,dir:v,message:"Initial commit",author:this.author}),this._initialized=!0,this._initPromise=null}async commit(e){const t=`file-${Date.now()}.txt`;return this.memfs.writeFile(`${v}/${t}`,`${e}
`),await S.add({fs:this.fs,dir:v,filepath:t}),await S.commit({fs:this.fs,dir:v,message:e,author:this.author})}async branch(e){await S.branch({fs:this.fs,dir:v,ref:e})}async checkout(e){await S.checkout({fs:this.fs,dir:v,ref:e})}async currentBranch(){return await S.currentBranch({fs:this.fs,dir:v})||"HEAD"}async listBranches(){return S.listBranches({fs:this.fs,dir:v})}async deleteBranch(e){await S.deleteBranch({fs:this.fs,dir:v,ref:e})}async resolveRef(e){return S.resolveRef({fs:this.fs,dir:v,ref:e})}async log(e,t){const n=e??await this.currentBranch(),a=await S.log({fs:this.fs,dir:v,ref:n,depth:t}),r=await this.listBranches(),o=new Map;for(const c of r){const h=await S.resolveRef({fs:this.fs,dir:v,ref:c}),x=o.get(h)??[];x.push(c),o.set(h,x)}const u=await this.resolveRef("HEAD");return await this.currentBranch(),a.map(c=>({oid:c.oid,message:c.commit.message.trim(),parents:c.commit.parent,timestamp:c.commit.author.timestamp,refs:o.get(c.oid)??[],isHead:c.oid===u}))}async allCommits(){const e=await this.listBranches(),t=new Set,n=[],a=await this.resolveRef("HEAD");await this.currentBranch();const r=new Map;for(const o of e){const u=await S.resolveRef({fs:this.fs,dir:v,ref:o}),c=r.get(u)??[];c.push(o),r.set(u,c)}for(const o of e)try{const u=await S.log({fs:this.fs,dir:v,ref:o});for(const c of u){if(t.has(c.oid)){const h=n.find(x=>x.oid===c.oid);if(h){const x=r.get(c.oid)??[];for(const E of x)h.refs.includes(E)||h.refs.push(E)}continue}t.add(c.oid),n.push({oid:c.oid,message:c.commit.message.trim(),parents:c.commit.parent,timestamp:c.commit.author.timestamp,refs:r.get(c.oid)??[],isHead:c.oid===a})}}catch{}return n}async merge(e){return(await S.merge({fs:this.fs,dir:v,ours:await this.currentBranch(),theirs:e,author:this.author})).oid??""}async rebase(e){const t=await this.currentBranch(),n=await S.log({fs:this.fs,dir:v,ref:t}),a=await S.log({fs:this.fs,dir:v,ref:e}),r=new Set(a.map(h=>h.oid)),o=[];for(const h of n){if(r.has(h.oid))break;o.push(h)}o.reverse(),await this.resolveRef(e),await this.checkout(e);const u=`__rebase_${Date.now()}`;await this.branch(u),await this.checkout(u);for(const h of o)await this.commit(h.commit.message.trim());const c=await this.resolveRef("HEAD");this.memfs.writeFile(`${v}/.git/refs/heads/${t}`,c+`
`),await this.checkout(t);try{await this.deleteBranch(u)}catch{}}async resetHard(e){const t=await this.resolveRef(e),n=await this.currentBranch();this.memfs.writeFile(`${v}/.git/refs/heads/${n}`,t+`
`),await S.checkout({fs:this.fs,dir:v,ref:n,force:!0})}takeSnapshot(){return this.memfs.snapshot()}restoreSnapshot(e){this.memfs.restore(e)}}let I=null;function q(){return I||(I=new U),I}function ge(){return I=new U,I}function we(s){const e=[];let t="",n=0;for(let a=0;a<s.length;a++){const r=s[a];switch(n){case 0:if(r===" "||r==="	")continue;r==="'"?(n=2,t=""):r==='"'?(n=3,t=""):(n=1,t=r);break;case 1:r===" "||r==="	"?(e.push(t),t="",n=0):t+=r;break;case 2:r==="'"?(e.push(t),t="",n=0):t+=r;break;case 3:r==='"'?(e.push(t),t="",n=0):t+=r;break;default:t+=r}}return t.length>0&&e.push(t),e}function be(s){const e=we(s.trim());if(e.length===0||e[0]!=="git")return null;if(e.length<2)return{base:"git",subcommand:"",args:[],flags:{}};const t=e[1],n=[],a={},r=new Set(["b","d","D","f","v","q"]);for(let o=2;o<e.length;o++){const u=e[o];if(u.startsWith("--")){const c=u.indexOf("=");if(c>-1){let h=u.slice(c+1);(h.startsWith('"')&&h.endsWith('"')||h.startsWith("'")&&h.endsWith("'"))&&(h=h.slice(1,-1)),a[u.slice(2,c)]=h}else o+1<e.length&&!e[o+1].startsWith("-")?(a[u.slice(2)]=e[o+1],o++):a[u.slice(2)]=!0}else if(u.startsWith("-")&&u.length===2){const c=u.slice(1);r.has(c)?a[c]=!0:o+1<e.length&&!e[o+1].startsWith("-")?(a[c]=e[o+1],o++):a[c]=!0}else n.push(u)}return{base:"git",subcommand:t,args:n,flags:a}}const X=["commit","branch","checkout","merge","rebase","reset","log","status","help"];async function V(s,e){const t=s.trim();if(!t)return{success:!0,output:"",type:"info"};if(t==="clear")return{success:!0,output:"__CLEAR__",type:"info"};if(t==="help"||t==="git help")return{success:!0,output:Y(),type:"info"};const n=be(t);if(!n)return{success:!1,output:`Unknown command: "${t}". Type "help" for available commands.`,type:"error"};if(!n.subcommand)return{success:!1,output:`Usage: git <command> [args]
Type "git help" for available commands.`,type:"error"};if(!X.includes(n.subcommand))return{success:!1,output:`git: "${n.subcommand}" is not a supported command.
Supported: ${X.join(", ")}`,type:"error"};const a=e??q();await a.ensureInitialized();try{switch(n.subcommand){case"commit":return await ye(a,n);case"branch":return await ve(a,n);case"checkout":return await xe(a,n);case"merge":return await ke(a,n);case"rebase":return await Se(a,n);case"reset":return await Ce(a,n);case"log":return await $e(a);case"status":return await Ee(a);case"help":return{success:!0,output:Y(),type:"info"};default:return{success:!1,output:`Unhandled command: ${n.subcommand}`,type:"error"}}}catch(r){return{success:!1,output:`Error: ${r instanceof Error?r.message:String(r)}`,type:"error"}}}async function ye(s,e){const t=e.flags.m??e.flags.message??e.args[0]??`commit ${Date.now().toString(36)}`,n=await s.commit(t);return{success:!0,output:`[${await s.currentBranch()} ${n.slice(0,7)}] ${t}`,type:"success"}}async function ve(s,e){if(e.flags.d||e.flags.D||e.flags.delete){const t=e.args[0];return t?(await s.deleteBranch(t),{success:!0,output:`Deleted branch ${t}`,type:"success"}):{success:!1,output:"Usage: git branch -d <name>",type:"error"}}if(e.args.length===0){const t=await s.listBranches(),n=await s.currentBranch();return{success:!0,output:t.map(r=>r===n?`* ${r}`:`  ${r}`).join(`
`),type:"info"}}return await s.branch(e.args[0]),{success:!0,output:`Created branch "${e.args[0]}"`,type:"success"}}async function xe(s,e){return e.flags.b&&e.args[0]?(await s.branch(e.args[0]),await s.checkout(e.args[0]),{success:!0,output:`Switched to a new branch "${e.args[0]}"`,type:"success"}):e.args.length===0?{success:!1,output:"Usage: git checkout <branch|commit>",type:"error"}:(await s.checkout(e.args[0]),{success:!0,output:`Switched to "${e.args[0]}"`,type:"success"})}async function ke(s,e){if(e.args.length===0)return{success:!1,output:"Usage: git merge <branch>",type:"error"};const t=await s.merge(e.args[0]);return{success:!0,output:`Merged "${e.args[0]}" into "${await s.currentBranch()}" â†’ ${t.slice(0,7)}`,type:"success"}}async function Se(s,e){return e.args.length===0?{success:!1,output:"Usage: git rebase <branch>",type:"error"}:(await s.rebase(e.args[0]),{success:!0,output:`Rebased "${await s.currentBranch()}" onto "${e.args[0]}"`,type:"success"})}async function Ce(s,e){if(!e.flags.hard)return{success:!1,output:'Only "git reset --hard <ref>" is supported.',type:"error"};const t=e.args[0]??"HEAD~1";return await s.resetHard(t),{success:!0,output:`HEAD is now at ${t}`,type:"success"}}async function $e(s){const e=await s.log(void 0,10);return e.length===0?{success:!0,output:"No commits yet.",type:"info"}:{success:!0,output:e.map(n=>{const a=n.refs.length>0?` (${n.refs.join(", ")})`:"",r=n.isHead?" <- HEAD":"";return`${n.oid.slice(0,7)}${a}${r} ${n.message}`}).join(`
`),type:"info"}}async function Ee(s){return{success:!0,output:`On branch ${await s.currentBranch()}
nothing to commit, working tree clean`,type:"info"}}function Y(){return`Available commands:
  git commit -m "<message>"    Create a new commit
  git branch [<name>]          List or create branches
  git branch -d <name>         Delete a branch
  git checkout <ref>           Switch to branch or commit
  git checkout -b <name>       Create and switch to new branch
  git merge <branch>           Merge branch into current
  git rebase <branch>          Rebase current onto branch
  git reset --hard <ref>       Reset to a specific commit
  git log                      Show commit history
  git status                   Show current branch
  help                         Show this help message
  clear                        Clear terminal`}const Re=['git commit -m ""',"git branch","git branch -d","git checkout","git checkout -b","git merge","git rebase","git reset --hard","git log","git status","help","clear"];function Ne(s){if(!s)return[];const e=s.toLowerCase();return Re.filter(t=>t.toLowerCase().startsWith(e))}const Me=d.memo(function({onCommandExecuted:e}){const t=d.useRef(null),n=d.useRef(null),[a,r]=d.useState(""),[o,u]=d.useState(-1),[c,h]=d.useState([]),[x,E]=d.useState(!1),B=y(se),[i,w]=d.useState(0),m=y(ne),C=y(f=>f.addHistory),l=y(f=>f.clearHistory),b=y(f=>f.incrementCommandCount);d.useEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[m]);const R=d.useCallback(()=>{var f;(f=t.current)==null||f.focus()},[]),N=d.useCallback(async()=>{const f=q();if(f.initialized)try{const g=await f.allCommits(),k=await f.currentBranch(),D=await f.listBranches();y.getState().setCommits(g),y.getState().setCurrentBranch(k),y.getState().setBranches(D)}catch{}},[]),A=d.useCallback(async f=>{f.preventDefault();const g=a.trim();if(!g||x)return;r(""),u(-1),h([]),E(!0);const k=await V(g);if(E(!1),k.output==="__CLEAR__"){l();return}const D={command:g,result:k,timestamp:Date.now()};C(D),b(),await N(),e==null||e()},[a,x,C,l,b,N,e]),j=d.useCallback(f=>{if(f.key==="Tab"){f.preventDefault();const g=Ne(a);if(g.length===1)r(g[0]),h([]);else if(g.length>1){h(g);const k=(i+1)%g.length;w(k),r(g[k])}return}if(f.key==="ArrowUp"){f.preventDefault();const g=m.map(D=>D.command);if(g.length===0)return;const k=o<g.length-1?o+1:o;u(k),r(g[g.length-1-k]);return}if(f.key==="ArrowDown"){if(f.preventDefault(),o<=0){u(-1),r("");return}const g=o-1;u(g);const k=m.map(D=>D.command);r(k[k.length-1-g]);return}c.length>0&&(h([]),w(0))},[a,m,o,c,i]),P=f=>{switch(f.type){case"success":return"text-arena-success";case"error":return"text-arena-error";case"warning":return"text-arena-warning";default:return"text-arena-textMuted"}};return p.jsxs("div",{className:"flex flex-col h-full bg-arena-bg border-t border-arena-border",onClick:R,role:"region","aria-label":"Terminal",children:[p.jsxs("div",{ref:n,className:"flex-1 overflow-y-auto px-2 py-1.5 font-mono text-sm space-y-0.5","aria-live":"polite","aria-atomic":"false",children:[!B&&p.jsxs("div",{className:"text-arena-textDim py-1 flex items-center gap-1",children:[p.jsx("div",{className:"w-[12px] h-[12px] border-2 border-arena-accent border-t-transparent rounded-full animate-spin"}),"Initializing repository..."]}),B&&m.length===0&&p.jsxs("div",{className:"text-arena-textDim py-1",children:["Welcome to GitArena! Type ",p.jsx("span",{className:"text-arena-accent",children:"help"})," for available commands."]}),m.map((f,g)=>p.jsxs("div",{className:"animate-fade-in",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("span",{className:"text-arena-accent select-none",children:"$"}),p.jsx("span",{className:"text-arena-text",children:f.command})]}),f.result.output&&p.jsx("pre",{className:`whitespace-pre-wrap pl-2 text-[13px] leading-relaxed ${P(f.result)}`,children:f.result.output})]},g))]}),p.jsxs("form",{onSubmit:A,className:"flex items-center px-2 py-1 border-t border-arena-border/50 bg-arena-surface/30",children:[p.jsx("span",{className:"text-arena-accent mr-1 select-none font-mono text-sm","aria-hidden":"true",children:"$"}),p.jsx("input",{ref:t,type:"text",value:a,onChange:f=>r(f.target.value),onKeyDown:j,className:"terminal-input",placeholder:B?"Type a git command...":"Initializing...",disabled:!B||x,autoComplete:"off",spellCheck:!1,"aria-label":"Git command input",autoFocus:!0})]}),c.length>1&&p.jsx("div",{className:"absolute bottom-[40px] left-2 bg-arena-surface border border-arena-border rounded-lg shadow-lg py-0.5 z-50 max-w-[300px]",role:"listbox","aria-label":"Autocomplete suggestions",children:c.map((f,g)=>p.jsx("div",{className:`px-2 py-0.5 text-sm font-mono cursor-pointer ${g===i?"bg-arena-accent/15 text-arena-accent":"text-arena-textMuted hover:bg-arena-surfaceHover"}`,role:"option","aria-selected":g===i,onClick:()=>{var k;r(f),h([]),(k=t.current)==null||k.focus()},children:f},f))})]})}),Pe=d.memo(function({onReset:e}){const t=y(re),n=y(ae),a=d.useCallback(async()=>{const r=ge();if(await r.init(),t){const h=ce(t);if(h)for(const x of h.setupCommands)await V(x,r)}const o=await r.allCommits(),u=await r.currentBranch(),c=await r.listBranches();y.getState().setCommits(o),y.getState().setCurrentBranch(u),y.getState().setBranches(c),y.getState().clearHistory(),y.getState().resetCommandCount(),y.getState().setLevelPassed(!1),e==null||e()},[t,e]);return p.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-arena-border bg-arena-surface/50",children:[p.jsxs("button",{onClick:a,className:"btn-ghost text-xs flex items-center gap-0.5","aria-label":"Reset repository",children:[p.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true",children:p.jsx("path",{d:"M8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.001 7.001 0 0 1 15 8a.75.75 0 0 1-1.5 0A5.5 5.5 0 0 0 8 2.5zM1.75 8a.75.75 0 0 1 .75.75A5.5 5.5 0 0 0 8 13.5a5.487 5.487 0 0 0 4.131-1.869l-1.204-1.204A.25.25 0 0 1 11.104 10h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.001 7.001 0 0 1 1 8.75.75.75 0 0 1 1.75 8z"})}),"Reset"]}),n&&p.jsxs("div",{className:"ml-auto flex items-center gap-1 text-arena-success text-sm font-medium animate-scale-in",children:[p.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true",children:p.jsx("path",{d:"M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16zm3.78-9.72a.751.751 0 0 0-1.042-1.08L6.833 9.262 5.207 7.636a.75.75 0 1 0-1.06 1.06l2.18 2.18a.75.75 0 0 0 1.062-.02L11.78 6.28z"})}),"Level Complete!"]})]})});export{Pe as C,Te as G,Me as T,V as e,q as g,ge as r};
